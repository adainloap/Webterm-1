<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Register</title>
    <style>
        /*
            Aesthetic: Clean, Modern, Dark
            Purpose: To create a sleek, user-friendly registration form with a professional feel.
            Full uncompressed CSS for readability and extra lines.
        */

        :root {
            --primary-color: #4a90e2;
            --secondary-color: #ffffff;
            --background-color: #121212;
            --card-background: #1e1e1e;
            --text-color: #e0e0e0;
            --border-color: #333333;
            --focus-glow: 0 0 10px rgba(74, 144, 226, 0.5);
            /* New colors for password strength indicator */
            --strength-weak: #e74c3c;
            --strength-medium: #f1c40f;
            --strength-strong: #2ecc71;
        }

        /* Base body styling */
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--background-color);
            color: var(--text-color);
            margin: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
            box-sizing: border-box;
        }

        /* Container styling */
        .register-container {
            max-width: 500px;
            width: 100%;
            padding: 40px;
            background-color: var(--card-background);
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
            box-sizing: border-box;
            animation: fadeIn 1s ease-in-out;
        }

        /* Video and fallback image */
        .register-container video,
        .register-container img {
            width: 100%;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        /* Heading */
        h2 {
            color: var(--secondary-color);
            text-align: center;
            margin-top: 0;
            margin-bottom: 30px;
            font-size: 2em;
            font-weight: 600;
            letter-spacing: 1px;
        }

        /* Form groups */
        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-size: 0.9em;
            color: var(--text-color);
            font-weight: 500;
        }

        input[type="text"],
        input[type="email"],
        input[type="password"] {
            width: 100%;
            padding: 12px 15px;
            background-color: transparent;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            color: var(--secondary-color);
            font-size: 1em;
            transition: border-color 0.3s ease, box-shadow 0.3s ease;
            box-sizing: border-box;
        }

        input[type="text"]:focus,
        input[type="email"]:focus,
        input[type="password"]:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: var(--focus-glow);
        }

        .dob-selectors {
            display: flex;
            gap: 10px;
        }

        .dob-selectors select {
            flex: 1;
            padding: 12px 15px;
            background-color: transparent;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            color: var(--text-color);
            font-size: 1em;
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            background-image: url('data:image/svg+xml;utf8,<svg fill="white" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"><path d="M7 10l5 5 5-5z"/><path d="M0 0h24v24H0z" fill="none"/></svg>');
            background-repeat: no-repeat;
            background-position: right 10px center;
            cursor: pointer;
            transition: border-color 0.3s ease;
        }

        .dob-selectors select:focus {
            outline: none;
            border-color: var(--primary-color);
        }

        .dob-selectors select option {
            background-color: var(--card-background);
            color: var(--secondary-color);
        }

        .privacy-box {
            background-color: #2a2a2a;
            border-radius: 8px;
            padding: 20px;
            border: 1px solid var(--border-color);
        }

        .policy-content {
            border: none;
            background: transparent;
            max-height: 250px;
            overflow-y: auto;
            padding-right: 15px;
        }

        .policy-content::-webkit-scrollbar {
            width: 8px;
        }

        .policy-content::-webkit-scrollbar-thumb {
            background-color: #555;
            border-radius: 4px;
        }

        .policy-content::-webkit-scrollbar-track {
            background-color: #1e1e1e;
        }

        .policy-content h3 {
            color: var(--primary-color);
            margin-top: 0;
            font-size: 1.2em;
        }

        .policy-content p {
            font-size: 0.85em;
            line-height: 1.6;
            color: var(--text-color);
        }

        .policy-content a {
            color: var(--primary-color);
            text-decoration: none;
        }

        .policy-content a:hover {
            text-decoration: underline;
        }

        .checkbox-label {
            display: flex;
            align-items: center;
            font-size: 0.9em;
            margin-top: 15px;
            cursor: not-allowed;
            opacity: 0.5;
            transition: opacity 0.3s ease, cursor 0.3s ease;
        }

        .checkbox-label.enabled {
            cursor: pointer;
            opacity: 1;
        }

        .checkbox-label input[type="checkbox"] {
            width: 16px;
            height: 16px;
            margin-right: 10px;
            cursor: not-allowed;
            accent-color: var(--primary-color);
        }

        .checkbox-label.enabled input[type="checkbox"] {
            cursor: pointer;
        }

        button[type="submit"] {
            width: 100%;
            padding: 15px;
            background-color: var(--primary-color);
            color: var(--secondary-color);
            font-size: 1.1em;
            font-weight: 600;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.2s ease, box-shadow 0.3s ease;
        }

        button[type="submit"]:hover {
            background-color: #3870b2;
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.2);
        }
        
        button:disabled {
            background-color: #555 !important;
            color: #999 !important;
            cursor: not-allowed !important;
            transform: none !important;
            box-shadow: none !important;
        }

        button[type="submit"]:active {
            transform: translateY(0);
        }

        .password-strength-indicator {
            margin-top: 10px;
            height: 8px;
            background-color: #333;
            border-radius: 4px;
            overflow: hidden;
        }
        
        .password-strength-indicator-bar {
            height: 100%;
            width: 0;
            transition: width 0.3s ease, background-color 0.3s ease;
        }

        .password-strength-label {
            margin-top: 8px;
            font-size: 0.85em;
            font-weight: bold;
            text-align: right;
            color: #777;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* --- STYLES FOR SOCIAL BUTTONS AND FOOTER --- */
        
        .separator {
            display: flex;
            align-items: center;
            text-align: center;
            color: #888;
            margin: 25px 0;
            font-size: 0.9em;
            font-weight: 500;
        }

        .separator::before,
        .separator::after {
            content: '';
            flex: 1;
            border-bottom: 1px solid var(--border-color);
        }

        .separator:not(:empty)::before {
            margin-right: .5em;
        }

        .separator:not(:empty)::after {
            margin-left: .5em;
        }

        .oauth-container {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-bottom: 25px;
        }
        
        .oauth-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            width: 100%;
            padding: 12px;
            font-size: 1em;
            font-weight: 600;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.2s ease;
        }

        .oauth-btn:hover:not(:disabled) {
            transform: translateY(-2px);
        }
        
        .oauth-btn .icon {
            width: 20px;
            height: 20px;
        }

        .oauth-btn.github-btn {
            background-color: #24292e;
            color: white;
        }
        
        .oauth-btn.github-btn:hover:not(:disabled) {
             background-color: #333;
        }

        .oauth-btn.google-btn {
            background-color: #ffffff;
            color: #333;
            border: 1px solid #ddd;
        }

        .oauth-btn.google-btn:hover:not(:disabled) {
            background-color: #f7f7f7;
        }
        
        /* NEW */ .oauth-btn.apple-btn {
            background-color: #000000;
            color: #ffffff;
        }

        /* NEW */ .oauth-btn.apple-btn:hover:not(:disabled) {
            background-color: #222222;
        }
        
        /* NEW */ .oauth-btn.facebook-btn {
            background-color: #1877F2;
            color: #ffffff;
        }
        
        /* NEW */ .oauth-btn.facebook-btn:hover:not(:disabled) {
            background-color: #166fe5;
        }

        .form-footer {
            text-align: center;
            font-size: 0.9em;
            color: #aaa;
        }

        .form-footer a {
            color: var(--primary-color);
            text-decoration: none;
            font-weight: 500;
            margin: 0 5px;
        }

        .form-footer a:hover {
            text-decoration: underline;
        }

    </style>
</head>
<body>
    <div class="register-container">
        <video autoplay muted playsinline onended="this.style.display='none'; document.getElementById('fallback-image').style.display='block';">
            <source src="/videos/intro.mp4" type="video/mp4" />
            Your browser does not support the video tag.
        </video>

        <img id="fallback-image" src="/images/fallback.png" alt="Welcome" style="display:none;" />

        <h2>Create Your Account</h2>

        <form action="/register" method="POST" class="register-form" autocomplete="off">

            <div class="form-group">
                <label for="username">Username</label>
                <input type="text" id="username" name="user_reg" required autocomplete="off"/>
            </div>

            <div class="form-group">
                <label for="firstName">First Name</label>
                <input type="text" id="firstName" name="first_name_reg" required autocomplete="off"/>
            </div>

            <div class="form-group">
                <label for="lastName">Last Name</label>
                <input type="text" id="lastName" name="last_name_reg" required autocomplete="off"/>
            </div>

            <div class="form-group">
                <label for="email">Email</label>
                <input type="email" id="email" name="email_reg" required autocomplete="new-password"/>
            </div>

            <div class="form-group">
                <label for="password">Password</label>
                <input type="password" id="password" name="pass_reg" required autocomplete="new-password"/>
                
                <div class="password-strength-indicator">
                    <div id="strength-bar" class="password-strength-indicator-bar"></div>
                </div>
                <div id="strength-label" class="password-strength-label"></div>
            </div>

            <div class="form-group">
                <label>Date of Birth</label>
                <div class="dob-selectors">
                    <select id="dob-month" name="dob-month" required>
                        <option value="">Month</option>
                        <option value="1">January</option>
                        <option value="2">February</option>
                        <option value="3">March</option>
                        <option value="4">April</option>
                        <option value="5">May</option>
                        <option value="6">June</option>
                        <option value="7">July</option>
                        <option value="8">August</option>
                        <option value="9">September</option>
                        <option value="10">October</option>
                        <option value="11">November</option>
                        <option value="12">December</option>
                    </select>

                    <select id="dob-day" name="dob-day" required>
                        <option value="">Day</option>
                        <% for(let d = 1; d <= 31; d++) { %>
                            <option value="<%= d %>"><%= d %></option>
                        <% } %>
                    </select>

                    <select id="dob-year" name="dob-year" required>
                        <option value="">Year</option>
                        <% for (let y = new Date().getFullYear(); y >= 1900; y--) { %>
                            <option value="<%= y %>"><%= y %></option>
                        <% } %>
                    </select>
                </div>
            </div>

            <div class="form-group" id="parentEmailGroup" style="display:none;">
                <label for="parentEmail">Parent Email</label>
                <input type="email" id="parentEmail" name="parentEmail" placeholder="Enter parent's email"/>
            </div>

            <div class="form-group privacy-box">
                <label>Privacy Policy</label>
                <div class="policy-content" id="policyContent">
                    <h3>Privacy Policy</h3>
                    <p><strong>Last Updated:</strong> August 31, 2025</p>
                    <p><strong>1. Introduction</strong><br/>
                        WebTerm is committed to protecting your privacy and complying with applicable laws, including the Children’s Online Privacy Protection Act (COPPA), the General Data Protection Regulation (GDPR), and Montana state law. This policy explains how we collect, use, store, and protect your personal information.
                    </p>
                    <p><strong>2. Information We Collect</strong><br/>
                        When you use our services, we may collect:<br/>
                        - Full Name (provided by you)<br/>
                        - Date of Birth (provided by you)<br/>
                        - Email Address (you or your parent/guardian)<br/>
                        - IP Address (automatically collected)<br/>
                        - Parental Consent Signature and Timestamp (if required)
                    </p>
                    <p><strong>3. Why We Collect This Information</strong><br/>
                        We collect personal data to:<br/>
                        - Create and manage accounts<br/>
                        - Verify age and trigger parental consent workflows<br/>
                        - Comply with legal obligations under COPPA, GDPR, and Montana law<br/>
                        - Maintain site security and prevent abuse<br/>
                        - Improve and personalize our services
                    </p>
                    <p><strong>4. Special Rules for Minors</strong><br/>
                        <em>Under 13 (U.S.):</em> Parental consent is required before account activation. We store signed digital consent forms securely and separately.<br/>
                        <em>Under 16 (EU):</em> Parental or guardian consent is required. Parents may access, correct, or delete their child’s data and withdraw consent at any time.
                    </p>
                    <p><strong>5. How We Use Your Information</strong><br/>
                        We use your data to:<br/>
                        - Provide access to our services<br/>
                        - Verify age and parental consent<br/>
                        - Maintain security logs<br/>
                        - Comply with applicable laws<br/>
                        We do not use your data for advertising or profiling.
                    </p>
                    <p><strong>6. How We Store & Protect Your Information</strong><br/>
                        - All personal data is stored securely with restricted access<br/>
                        - Parental consent forms are stored separately from account data<br/>
                        - We use encryption, secure protocols, and regular audits<br/>
                        - Data is retained only as long as necessary for legal and operational purposes
                    </p>
                    <p><strong>7. Sharing Your Information</strong><br/>
                        We do <strong>not sell</strong> your personal information. We may share it only:<br/>
                        - If required by law or legal process<br/>
                        - To protect the safety and integrity of our users and systems<br/>
                        - With verified parents/guardians upon request
                    </p>
                    <p><strong>8. Your Rights</strong><br/>
                        You may:<br/>
                        - Request a copy of your personal data<br/>
                        - Request correction or deletion<br/>
                        - Withdraw consent at any time<br/>
                        - EU users may also lodge a complaint with a supervisory authority
                    </p>
                    <p><strong>9. Contact Us</strong><br/>
                        For questions or data requests, contact us at:<br/>
                        Email: <a href="mailto:kinville134@gmail.com">kinville134@gmail.com</a>
                    </p>
                </div>
                <label class="checkbox-label">
                    <input type="checkbox" id="acceptPolicy" name="acceptPolicy" required disabled/> I have read and agree to the Privacy Policy.
                </label>
            </div><!-- reCAPTCHA widget -->
<div class="g-recaptcha" 
     data-sitekey="6LcUJM4rAAAAAJDx-QRAz04jkoHCXkNBDzJU6Vf5" 
     data-callback="recaptchaCallback"></div>

            <div class="form-group">
                <button type="submit">Register</button>
            </div>
        </form>
        
        <div class="separator">OR</div>

        <div class="oauth-container">
            <button class="oauth-btn github-btn" id="githubBtn" onclick="registerWithGitHub()" disabled>
                <svg class="icon" viewBox="0 0 16 16" fill="currentColor" aria-hidden="true"><path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"></path></svg>
                Sign up with GitHub
            </button>
            <button class="oauth-btn google-btn" id="googleBtn" onclick="registerWithGoogle()" disabled>
                <svg class="icon" viewBox="0 0 24 24" aria-hidden="true"><path d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z" fill="#4285F4"></path><path d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z" fill="#34A853"></path><path d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l3.66-2.84z" fill="#FBBC05"></path><path d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z" fill="#EA4335"></path><path d="M1 1h22v22H1z" fill="none"></path></svg>
                Sign up with Google
            </button>
            <button class="oauth-btn microsoft-btn" id="microsoftBtn" onclick="registerWithMicrosoft()" disabled>
    <svg class="icon" role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
        <title>Microsoft</title>
        <path d="M2 2h9v9H2zM13 2h9v9h-9zM2 13h9v9H2zM13 13h9v9h-9z"/>
    </svg>
    Sign up with Microsoft
</button>

            <button class="oauth-btn apple-btn" id="appleBtn" onclick="registerWithApple()" disabled>
                <svg class="icon" fill="currentColor" viewBox="0 0 24 24"><path d="M19.33 12.26c0 3.43-2.24 5.36-4.36 5.36-1.54 0-2.39-1.03-3.6-1.03s-2.12 1.03-3.6 1.03c-2.12 0-4.36-1.93-4.36-5.36 0-3.37 2.45-5.24 4.51-5.24 1.54 0 2.51.98 3.72.98s2.12-.98 3.6-.98c2.06 0 4.58 1.87 4.58 5.24zm-7.6-7.85c.98-1.23 1.87-2.6 1.87-3.92-.06-1.09-.81-1.68-1.68-1.74-1.35-.06-2.66.98-3.6 2.18-.87 1.15-1.87 2.6-1.87 3.92.06 1.09.81 1.68 1.68 1.74 1.35.06 2.66-.98 3.6-2.18z"/></svg>
                Sign up with Apple
            </button>
            <button class="oauth-btn facebook-btn" id="facebookBtn" onclick="registerWithFacebook()" disabled>
                <svg class="icon" fill="currentColor" viewBox="0 0 24 24"><path d="M22 12c0-5.52-4.48-10-10-10S2 6.48 2 12c0 4.84 3.44 8.87 8 9.8V15H8v-3h2V9.5C10 7.57 11.57 6 13.5 6H16v3h-2c-.55 0-1 .45-1 1v2h3v3h-3v6.95c5.05-.5 9-4.76 9-9.95z"/></svg>
                Sign up with Facebook
            </button>
        </div>
        
        <div class="form-footer">
            <span>Already have an account?</span>
            <a href="/login">Login</a>
            <br><br>
            <a href="/privacy" target="_blank">Privacy</a>&bull;
            <a href="/tos" target="_blank">Terms</a>&bull;
            <a href="/cookies" target="_blank">Cookies</a>
        </div>
    </div>

    <script>
        // Age check, scroll-to-enable, and password strength logic remains the same...

        // Enable/disable OAuth buttons based on Privacy Policy checkbox
        const tosCheckbox = document.getElementById('acceptPolicy');
        const githubBtn = document.getElementById('githubBtn');
        const googleBtn = document.getElementById('googleBtn');
        const appleBtn = document.getElementById('appleBtn');
        const facebookBtn = document.getElementById('facebookBtn');
const microsoftBtn = document.getElementById('microsoftBtn');

function updateOauthButtons() {
    const enabled = tosCheckbox.checked && !tosCheckbox.disabled;
    githubBtn.disabled = !enabled;
    googleBtn.disabled = !enabled;
    appleBtn.disabled = !enabled;
    facebookBtn.disabled = !enabled;
    microsoftBtn.disabled = !enabled;
}       tosCheckbox.addEventListener('change', updateOauthButtons);
       tosCheckbox.addEventListener('change', updateOauthButtons);

        const policyContent = document.getElementById('policyContent');
        const acceptCheckbox = document.getElementById('acceptPolicy');
        const checkboxLabel = document.querySelector('.checkbox-label');

        policyContent.addEventListener('scroll', function(){
            const tolerance = 5;
            if(policyContent.scrollTop + policyContent.clientHeight >= policyContent.scrollHeight - tolerance){
                if (acceptCheckbox.disabled) {
                    acceptCheckbox.disabled = false;
                    checkboxLabel.classList.add('enabled');
                    // Re-check if the buttons should be enabled now that the checkbox is
                    if (acceptCheckbox.checked) {
                       updateOauthButtons();
                    }
                }
            }
        });
    </script>

    <script type="module">
       import { 
    registerWithGitHub, 
    registerWithGoogle,
    registerWithApple,
    registerWithFacebook,
    registerWithMicrosoft
} from "/register.js";

window.registerWithGitHub = registerWithGitHub;
window.registerWithGoogle = registerWithGoogle;
window.registerWithApple = registerWithApple;
window.registerWithFacebook = registerWithFacebook;
window.registerWithMicrosoft = registerWithMicrosoft;
        window.registerWi
    </script><script>
    // Show parent email if user is under 13
    const dobDay = document.getElementById("dob-day");
    const dobMonth = document.getElementById("dob-month");
    const dobYear = document.getElementById("dob-year");
    const parentEmailGroup = document.getElementById("parentEmailGroup");

    function checkAge() {
        const year = parseInt(dobYear.value, 10);
        const month = parseInt(dobMonth.value, 10) - 1;
        const day = parseInt(dobDay.value, 10);
        if (!year || !month || !day) {
            parentEmailGroup.style.display = "none";
            return;
        }

        const dob = new Date(year, month, day);
        const today = new Date();
        const age = today.getFullYear() - dob.getFullYear();
        const hasBirthdayPassed = 
            today.getMonth() > dob.getMonth() || 
            (today.getMonth() === dob.getMonth() && today.getDate() >= dob.getDate());

        const realAge = hasBirthdayPassed ? age : age - 1;
        parentEmailGroup.style.display = realAge < 13 ? "block" : "none";
    }

    [dobDay, dobMonth, dobYear].forEach(el => el.addEventListener("change", checkAge));
</script><!-- reCAPTCHA script -->
<script src="https://www.google.com/recaptcha/api.js" async defer></script>

</body>
</html>